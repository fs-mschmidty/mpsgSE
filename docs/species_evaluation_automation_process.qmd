---
title: Species Evaluation Automation Process
date: 2024-12-05
format:
  html: default
  pdf: default
  docx: default
execute:
  echo: true
  message: false
  warning: false
  class-output: 'r'
---

# Introduction

This document details the process of automating parts of the Mountain State Planning Group's (MPSG), Species Evaluations for Species of Conservation Concern (SCC). The MPSG is tasked with helping National Forests with planning efforts.  Part of the Pre-assessment portion of Forest Planning is writing Species Evaluations for SCC. Species assessments are intended to inform selection of SCC by the Regional Forester by providing the best available scientific (BASI) information on if there is "substantial concern about the speciesâ€™ capability to persist over the long-term in the plan area" (36 CFR 219.9(c)).  This process is detailed in draft in the "Species of Conservation Concern Identification Process" (CITE MPSG) document. This document is not intended to outline the SCC process.  Rather it will focus on documenting the automation of the process outlined in the SCC process document. 

Automation is recommended for this process for two primary reasons: hundreds of Species Evaluations are required for any given planning unit, resulting in a substantial workload.  Automation of repeatable steps decreases the workload of MPSG staff, produces more consistent and repeatable documents, and can help define, programmatically or otherwise, best sources of BASI and processes for retrieving BASI. 

# The Process

# Species Evaluation Automation Process

Broadly there are three parts to automating: 
1. Develop eligible list of species for potential listing as SCC
2. Gather available relevant BASI for species on the eligible list.
3. Automate SCC species evaluation templates with as much data pre input as possible.

## Process Preface

### The Use of R Programming Language

The MPSG uses the R programming language (CITE R) for much of the work we do in automation and will be referencing R code and packages in this document because it helps explain how we accomplished a lot of what we did.  However, automation is not necessarily dependent on R.  Many of these processes could be completed by other means and R is irrelevant to many of the data sources and structures we have developed at the MPSG. 

### Taxonomy
Before we explain the steps in the automation process it is important to mention how we handled species taxonomy.  One of the first hurdles that needed to be overcome at the beginning of automating the species evaluation process was how we were going to resolve taxonomy in a systematic and programmatic way. This process relies on dozens of external resources for information.  Many of those resources have their own methods for dealing with taxonomy, but almost all of them differ in how they define species.  This is particularly problematic in the botany world where many experts and institutions differ on plant taxonomy.  When we retrieve a list of species, weather it be status, spatial or some other resource, we needed a way to algorithmically settle on what that species was. It is important that it could be done algorythmically because we had to parse hundreds of thousands of records during this process. 

We tried a variety of resources to resolve taxonomies, but ultimately landed on using the [`taxize`] R package to access the GBIF Backbone Taxonomy. 

## Build Eligible List

### Unit Spatial Layers and Other Unit Relevant Spatial Layers

### Natureserve State List

1. Pull all species from natureserve for any given state[`mpsgSE::get_ns_state_list`](https://github.com/fs-mschmidty/mpsgSE/blob/main/R/get_ns_state_list.R)
  a. Scientific  Name
  b. Global Rank
  c. State Rank for given state. 
  d. USFWS status
2. Merge State Lists if necessary and keep only unique species
3. Use [`mpsgSE::get_taxonomies()`](https://github.com/fs-mschmidty/mpsgSE/blob/main/R/get_taxonomies.R) to acquire unique ID. 

### Get Occurrence Data Lists

<!-- Matt I think it would be best if you wrote this section. -->
<!-- For now these lists are just the lists have occurrence numbers and not the acual spatial data! (see section below "Load Occurrence Spatial Data") -->

* GBIF
* SEInet
* EO State Data (NHP Data)
* IMBCR Data
* NABat Data
* Maybe why we don't us Idigbio anymore

###  Get Qualifying Lists

* State T and E, and Tier 1 Lists
* Regional Sensitive Species Lists
* Neighboring Unit SCC lists
* USFWS Status (see above in Natureserve)

### Make Preliminary Eligible List

* To the Natureserve State List, which already includes global, state and USFWS ranks, full_join (So that if  species is not on one list it does not get dropped) by taxon_id:
  * State SWAP Lists
  * State T and E list
  * Regional Foresters List
  * Neighboring SCC lists
* Then to create all potential species eligible filter the list by: 
  * G/T 1,2 or 3 Ranks.
  * Any S/T 1 or 2 Ranks.
  * State SWAP Tier 1 Ranks
  * State T and E Ranks
  * Regional Foresters Sensitive Species Lists
  * Neighboring Regional SCC Designation
* Join all occurrence lists to all potential species eligible filtered list
* Filter by those species that have one occurrence record in the planning unit.

#### Notes on Taxonomic Problems in the Process

### Manually Check Accidental Transients, Native and Known, and Local Concern, to Produce Final SCC Eligible List

<!-- I think we should add into this process the Units local concern species -->

#### Transient Bird List
* Get ebird maps from ebirdst
* Do check on each species
* Output for manual checking

#### Filter those species that need native and known checks
* Those  species with less than 6 occurrences combined from each list in the planning area.
* Those species with their most recent detection being greater than 40 years ago. 

#### Species with uncertain taxanomic determinations
* Multiple species may be taxonomically identified as the same species with `get_taxonomies()`.  Becuase we cannot determine their taxonomic status programatically, we cannot join them to occurrence lists or status lists. Therefore they must be manually vetted. 

#### Get user feedback
#### Use user feedback to refine list
Based on manual checks remove species that are:
* Determined to not be native and known. 
* Determined to be accidental or transients
* ! Determined to be of local concern by the unit

## Retrieve External Data for Automating Reports

### Get Synonyms

### Get Data for Making Automated Maps

#### Load Occurrence Spatial Data

#### Load Species Distribution Models

* IUCN
* BIEN Plant Maps
* Ebird Maps

#### Get Other Base Map Information

* State Boundaries
* United States - lower 48
* North America
* The Americas (North and South America)
* Get Open Street Map Highways ("highway")
  * motorway
  * trunk
  * primary
* Clean Unit Names

#### Get Natureserve Habitats From the Natureserve API and Manually Crosswalk to Ecology

#### Retrieve, Clean, and Build Narratives for IMBCR Trend Information

#### Retrieve, Clean, and Build Narratives for Breeding Bird Survey

## Automate Reports
<!-- Look at the qmd and write out each section.  (Maybe should wait until we finish revamping the reports) -->

















